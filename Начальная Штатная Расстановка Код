&НаСервере
Процедура СоздатьНаСервере()  
	ТестШтатнаяРасстановка = Объект.ШтатнаяРасстановкаДляТеста;	
	НачальнаяШтатнаяРасстановка = Документы.НачальнаяШтатнаяРасстановка.СоздатьДокумент(); 
	НачальнаяШтатнаяРасстановка.Дата = КонецДня(Дата("20231231")); 
	
	// Выполняем общий запрос.  
	Запрос = Новый Запрос;
	Запрос.Текст = 
	"ВЫБРАТЬ
	|	КадроваяИсторияСотрудниковСрезПоследних.Подразделение КАК Подразделение,
	|	КадроваяИсторияСотрудниковСрезПоследних.Должность КАК Должность,
	|	КадроваяИсторияСотрудниковСрезПоследних.ДолжностьПоШтатномуРасписанию КАК ДолжностьПоШтатномуРасписанию,
	|	ПлановыеАвансыСрезПоследних.СпособРасчетаАванса КАК СпособРасчетаАванса,
	|	ПлановыеАвансыСрезПоследних.Аванс КАК Аванс,
	|	ВидыЗанятостиСотрудниковСрезПоследних.ВидЗанятости КАК ВидЗанятости,
	|	ПорядокРасчетаСтоимостиЕдиницыВремениСотрудниковСрезПоследних.ПорядокРасчета КАК ПорядокРасчета,
	|	РабочиеМестаСотрудниковСрезПоследних.РабочееМесто КАК РабочееМесто,
	|	ГрейдыПозиций.Грейд КАК Грейд,
	|	ГрафикРаботыСотрудниковСрезПоследних.ГрафикРаботы КАК ГрафикРаботы,
	|	КадроваяИсторияСотрудниковСрезПоследних.ВидСобытия КАК ВидСобытия,
	|	МАКСИМУМ(ЗначенияПериодическихПоказателейРасчетаЗарплатыСотрудниковСрезПоследних.Значение) КАК Размер,
	|	КадроваяИсторияСотрудниковСрезПоследних.Сотрудник КАК Сотрудник,
	|	КадроваяИсторияСотрудниковСрезПоследних.КоличествоСтавок КАК КоличествоСтавок
	|ИЗ
	|	РегистрСведений.ПлановыеАвансы.СрезПоследних(&Дата, ) КАК ПлановыеАвансыСрезПоследних
	|		ЛЕВОЕ СОЕДИНЕНИЕ РегистрСведений.ВидыЗанятостиСотрудников.СрезПоследних(&Дата, ) КАК ВидыЗанятостиСотрудниковСрезПоследних
	|		ПО ПлановыеАвансыСрезПоследних.Сотрудник = ВидыЗанятостиСотрудниковСрезПоследних.Сотрудник
	|		ЛЕВОЕ СОЕДИНЕНИЕ РегистрСведений.КадроваяИсторияСотрудников.СрезПоследних(&Дата, ) КАК КадроваяИсторияСотрудниковСрезПоследних
	|			ЛЕВОЕ СОЕДИНЕНИЕ РегистрСведений.ГрейдыПозиций КАК ГрейдыПозиций
	|			ПО КадроваяИсторияСотрудниковСрезПоследних.Должность = ГрейдыПозиций.Позиция
	|		ПО ПлановыеАвансыСрезПоследних.Сотрудник = КадроваяИсторияСотрудниковСрезПоследних.Сотрудник
	|		ЛЕВОЕ СОЕДИНЕНИЕ РегистрСведений.ПорядокРасчетаСтоимостиЕдиницыВремениСотрудников.СрезПоследних КАК ПорядокРасчетаСтоимостиЕдиницыВремениСотрудниковСрезПоследних
	|		ПО ПлановыеАвансыСрезПоследних.Сотрудник = ПорядокРасчетаСтоимостиЕдиницыВремениСотрудниковСрезПоследних.Сотрудник
	|		ЛЕВОЕ СОЕДИНЕНИЕ РегистрСведений.РабочиеМестаСотрудников.СрезПоследних(&Дата, ) КАК РабочиеМестаСотрудниковСрезПоследних
	|		ПО ПлановыеАвансыСрезПоследних.Сотрудник = РабочиеМестаСотрудниковСрезПоследних.Сотрудник
	|		ЛЕВОЕ СОЕДИНЕНИЕ РегистрСведений.ГрафикРаботыСотрудников.СрезПоследних(&Дата, ) КАК ГрафикРаботыСотрудниковСрезПоследних
	|		ПО ПлановыеАвансыСрезПоследних.Сотрудник = ГрафикРаботыСотрудниковСрезПоследних.Сотрудник
	|		ЛЕВОЕ СОЕДИНЕНИЕ РегистрСведений.ЗначенияПериодическихПоказателейРасчетаЗарплатыСотрудников.СрезПоследних(&ДатаНачислений, ) КАК ЗначенияПериодическихПоказателейРасчетаЗарплатыСотрудниковСрезПоследних
	|		ПО ПлановыеАвансыСрезПоследних.Сотрудник = ЗначенияПериодическихПоказателейРасчетаЗарплатыСотрудниковСрезПоследних.Сотрудник
	|ГДЕ
	|	ПлановыеАвансыСрезПоследних.ГоловнаяОрганизация = &ГоловнаяОрганизация
	|	И НЕ КадроваяИсторияСотрудниковСрезПоследних.ВидСобытия = &ВидСобытия
	|
	|СГРУППИРОВАТЬ ПО
	|	КадроваяИсторияСотрудниковСрезПоследних.Подразделение,
	|	КадроваяИсторияСотрудниковСрезПоследних.Должность,
	|	КадроваяИсторияСотрудниковСрезПоследних.ДолжностьПоШтатномуРасписанию,
	|	ПлановыеАвансыСрезПоследних.СпособРасчетаАванса,
	|	ПлановыеАвансыСрезПоследних.Аванс,
	|	ВидыЗанятостиСотрудниковСрезПоследних.ВидЗанятости,
	|	ПорядокРасчетаСтоимостиЕдиницыВремениСотрудниковСрезПоследних.ПорядокРасчета,
	|	РабочиеМестаСотрудниковСрезПоследних.РабочееМесто,
	|	ГрейдыПозиций.Грейд,
	|	ГрафикРаботыСотрудниковСрезПоследних.ГрафикРаботы,
	|	КадроваяИсторияСотрудниковСрезПоследних.ВидСобытия,
	|	КадроваяИсторияСотрудниковСрезПоследних.Сотрудник,
	|	КадроваяИсторияСотрудниковСрезПоследних.КоличествоСтавок";
	Запрос.УстановитьПараметр("Дата", КонецДня(Дата("20231231")));
	Запрос.УстановитьПараметр("ДатаНачислений", КонецДня(Дата("20240102")));

	Запрос.УстановитьПараметр("ГоловнаяОрганизация", Объект.Организация); 
	Запрос.УстановитьПараметр("ВидСобытия", Перечисления.ВидыКадровыхСобытий.Увольнение);
	
	
	Результат = Запрос.ВыполнитьПакет();
	Выборка = Результат[0].Выбрать();
	НачальнаяШтатнаяРасстановка.Месяц = Дата("20231231");
	НачальнаяШтатнаяРасстановка.Организация = Объект.Организация; 
	ИдентификаторСВР = 1;
	ИдентификаторСВРЛ = 1;
	ИдентификаторСВНадбавка =100;
	Пока Выборка.Следующий() Цикл
		///// Добавляем в табличную часть документа Сотрудники 
		СтрокаТабличнойЧастиСотрудник = НачальнаяШтатнаяРасстановка.Сотрудники.Добавить(); 	
		
		СтрокаТабличнойЧастиСотрудник.Сотрудник = Выборка.Сотрудник;
		СтрокаТабличнойЧастиСотрудник.Подразделение = Выборка.Подразделение;
		СтрокаТабличнойЧастиСотрудник.Должность = Выборка.Должность;
		СтрокаТабличнойЧастиСотрудник.ДолжностьПоШтатномуРасписанию = Выборка.ДолжностьПоШтатномуРасписанию;
		СтрокаТабличнойЧастиСотрудник.КоличествоСтавок = Выборка.КоличествоСтавок;
		СтрокаТабличнойЧастиСотрудник.СпособРасчетаАванса = Выборка.СпособРасчетаАванса;
		СтрокаТабличнойЧастиСотрудник.Аванс = Выборка.Аванс;
		СтрокаТабличнойЧастиСотрудник.ВидЗанятости = Выборка.ВидЗанятости;
		СтрокаТабличнойЧастиСотрудник.ПорядокРасчетаСтоимостиЕдиницыВремени = Выборка.ПорядокРасчета;
		СтрокаТабличнойЧастиСотрудник.СовокупнаяТарифнаяСтавка = Выборка.Размер;
		СтрокаТабличнойЧастиСотрудник.Грейд = Выборка.Грейд;
		СтрокаТабличнойЧастиСотрудник.РабочееМесто = Выборка.РабочееМесто;
		СтрокаТабличнойЧастиСотрудник.ГрафикРаботы = Выборка.ГрафикРаботы;
		
		//Выполняем запрос Отпуск по уходу
		ЗапросОтпускПоУходу = Новый Запрос;
		ЗапросОтпускПоУходу.Текст = "ВЫБРАТЬ
		                     |	ДанныеСостоянийСотрудников.ОкончаниеПредположительно КАК ОкончаниеПредположительно
		                     |ИЗ
		                     |	РегистрСведений.КадроваяИсторияСотрудников.СрезПоследних(&Дата, ) КАК КадроваяИсторияСотрудниковСрезПоследних
		                     |		ЛЕВОЕ СОЕДИНЕНИЕ РегистрСведений.ДанныеСостоянийСотрудников КАК ДанныеСостоянийСотрудников
		                     |		ПО КадроваяИсторияСотрудниковСрезПоследних.Сотрудник = ДанныеСостоянийСотрудников.Сотрудник
		                     |ГДЕ
		                     |	КадроваяИсторияСотрудниковСрезПоследних.Сотрудник = &Сотрудник
		                     |	И КадроваяИсторияСотрудниковСрезПоследних.ГоловнаяОрганизация = &ГоловнаяОрганизация
		                     |	И ДанныеСостоянийСотрудников.Состояние = &Состояние
		                     |	И ДанныеСостоянийСотрудников.Начало <= &Дата
		                     |	И ДанныеСостоянийСотрудников.ОкончаниеПредположительно > &Дата";
		
		ЗапросОтпускПоУходу.УстановитьПараметр("Дата", КонецДня(Дата("20231231"))); 
		ЗапросОтпускПоУходу.УстановитьПараметр("ГоловнаяОрганизация", Объект.Организация);
		ЗапросОтпускПоУходу.УстановитьПараметр("Состояние", Перечисления.СостоянияСотрудника.ОтпускПоУходуЗаРебенком); 
		ЗапросОтпускПоУходу.УстановитьПараметр("Сотрудник", Выборка.Сотрудник);
		РезультатаОтпускПоУходу = ЗапросОтпускПоУходу.Выполнить().Выбрать();
		Пока РезультатаОтпускПоУходу.Следующий() Цикл	
			СтрокаТабличнойЧастиСотрудник.ПланируемаяДатаВозврата = РезультатаОтпускПоУходу.ОкончаниеПредположительно;	
			
		КонецЦикла;

		
		СеверныйКэф = 0;
		//Выполняем запрос по таблицам Физ. Лиц.
		ЗапросФизлиц = Новый Запрос;
		ЗапросФизлиц.Текст = "ВЫБРАТЬ
		                     |	КадроваяИсторияСотрудниковСрезПоследних.ФизическоеЛицо КАК ФизическоеЛицо,
		                     |	ЕСТЬNULL(ПроцентыСевернойНадбавкиФизическихЛицСрезПоследних.ПроцентСевернойНадбавки, 0) КАК ПроцентСевернойНадбавки
		                     |ИЗ
		                     |	РегистрСведений.КадроваяИсторияСотрудников.СрезПоследних(&Дата, ) КАК КадроваяИсторияСотрудниковСрезПоследних
		                     |		ЛЕВОЕ СОЕДИНЕНИЕ РегистрСведений.ПроцентыСевернойНадбавкиФизическихЛиц.СрезПоследних(&Дата, ) КАК ПроцентыСевернойНадбавкиФизическихЛицСрезПоследних
		                     |		ПО КадроваяИсторияСотрудниковСрезПоследних.ФизическоеЛицо = ПроцентыСевернойНадбавкиФизическихЛицСрезПоследних.ФизическоеЛицо
		                     |ГДЕ
		                     |	КадроваяИсторияСотрудниковСрезПоследних.Сотрудник = &Сотрудник
		                     |	И КадроваяИсторияСотрудниковСрезПоследних.ГоловнаяОрганизация = &ГоловнаяОрганизация";
		
		ЗапросФизлиц.УстановитьПараметр("Дата", КонецДня(Дата("20231231"))); 
		ЗапросФизлиц.УстановитьПараметр("ГоловнаяОрганизация", Объект.Организация);
		ЗапросФизлиц.УстановитьПараметр("Сотрудник", Выборка.Сотрудник);
		РезультатаФизЛиц = ЗапросФизлиц.Выполнить().Выбрать();
		Пока РезультатаФизЛиц.Следующий() Цикл	
			/////////////ФизическиеЛица
			СтрокаТабличнойЧасти = НачальнаяШтатнаяРасстановка.ФизическиеЛица.Добавить();
			СтрокаТабличнойЧасти.ФизическоеЛицо = РезультатаФизЛиц.ФизическоеЛицо;
			СеверныйКэф =  РезультатаФизЛиц.ПроцентСевернойНадбавки /100;
		КонецЦикла;

		
		//Выполняем запрос по таблице Начислений.
		ЗапросНачислений = Новый Запрос;
		ЗапросНачислений.Текст = "ВЫБРАТЬ
		                         |	КадроваяИсторияСотрудниковСрезПоследних.Сотрудник КАК Сотрудник,
		                         |	ЗначенияПериодическихПоказателейРасчетаЗарплатыСотрудниковСрезПоследних.Значение КАК Размер,
		                         |	ЗначенияПериодическихПоказателейРасчетаЗарплатыСотрудниковСрезПоследних.Показатель КАК Показатель
		                         |ИЗ
		                         |	РегистрСведений.КадроваяИсторияСотрудников.СрезПоследних(&Дата, ) КАК КадроваяИсторияСотрудниковСрезПоследних
		                         |		ЛЕВОЕ СОЕДИНЕНИЕ РегистрСведений.ЗначенияПериодическихПоказателейРасчетаЗарплатыСотрудников.СрезПоследних(&ДатаНачисления, ) КАК ЗначенияПериодическихПоказателейРасчетаЗарплатыСотрудниковСрезПоследних
		                         |		ПО КадроваяИсторияСотрудниковСрезПоследних.Сотрудник = ЗначенияПериодическихПоказателейРасчетаЗарплатыСотрудниковСрезПоследних.Сотрудник
		                         |ГДЕ
		                         |	КадроваяИсторияСотрудниковСрезПоследних.ГоловнаяОрганизация = &ГоловнаяОрганизация
		                         |	И КадроваяИсторияСотрудниковСрезПоследних.Сотрудник = &Сотрудник"; 
		
		ЗапросНачислений.УстановитьПараметр("Дата", КонецДня(Дата("20231231"))); 
		ЗапросНачислений.УстановитьПараметр("ДатаНачисления", КонецДня(Дата("20240102")));
		ЗапросНачислений.УстановитьПараметр("ГоловнаяОрганизация", Объект.Организация);
		ЗапросНачислений.УстановитьПараметр("Сотрудник", Выборка.Сотрудник);
		РезультатНачисления = ЗапросНачислений.Выполнить().Выбрать();
		Пока РезультатНачисления.Следующий() Цикл 
			///////////Добавляем в табличную часть документа Начисления	
			СтрокаТабличнойЧасти = НачальнаяШтатнаяРасстановка.Начисления.Добавить();
			СтрокаТабличнойЧасти.Сотрудник = РезультатНачисления.Сотрудник; 
			Если РезультатНачисления.Показатель = Справочники.ПоказателиРасчетаЗарплаты.РайонныйКоэффициент Тогда
				СтрокаТабличнойЧасти.Начисление = ПланыВидовРасчета.Начисления.НайтиПоНаименованию("Районный коэффициент"); 
				СтрокаТабличнойЧасти.Размер = СтрокаТабличнойЧастиСотрудник.СовокупнаяТарифнаяСтавка * (РезультатНачисления.Размер-1);
			ИначеЕсли РезультатНачисления.Показатель = Справочники.ПоказателиРасчетаЗарплаты.Оклад Тогда  
				СтрокаТабличнойЧасти.Начисление = ПланыВидовРасчета.Начисления.НайтиПоНаименованию("Оплата по окладу");  
				СтрокаТабличнойЧасти.Размер = РезультатНачисления.Размер;
				СтрокаТабличнойЧасти.ДатаНачала = КонецДня(Дата("20231231"));
			КонецЕсли;

			//СтрокаТабличнойЧасти.Начисление = РезультатНачисления.Начисление;
			СтрокаТабличнойЧасти.ИдентификаторСтрокиВидаРасчета = ИдентификаторСВР;
						//СтрокаТабличнойЧасти.ДатаНачала = РезультатНачисления.Начало;
			//СтрокаТабличнойЧасти.ДатаОкончания = РезультатНачисления.Окончание;  
			
			ИдентификаторСВР = ИдентификаторСВР +1;
		КонецЦикла;	
		
		
		////ЗАПРОС НАЧИСЛЕНИЙ СЕВЕРНЫЙ КОЭФИЦИЕНТ
		//Выполняем запрос по таблице Начислений.
		ЗапросНачисленийСКФ = Новый Запрос;
		ЗапросНачисленийСКФ.Текст = "ВЫБРАТЬ
		                            |	ПлановыеНачисленияСрезПоследних.Размер КАК Размер,
		                            |	ПлановыеНачисленияСрезПоследних.Начисление КАК Начисление,
		                            |	КадроваяИсторияСотрудниковСрезПоследних.Сотрудник КАК Сотрудник
		                            |ИЗ
		                            |	РегистрСведений.КадроваяИсторияСотрудников.СрезПоследних(&Дата, ) КАК КадроваяИсторияСотрудниковСрезПоследних
		                            |		ЛЕВОЕ СОЕДИНЕНИЕ РегистрСведений.ПлановыеНачисления.СрезПоследних(&Дата, ) КАК ПлановыеНачисленияСрезПоследних
		                            |		ПО КадроваяИсторияСотрудниковСрезПоследних.Сотрудник = ПлановыеНачисленияСрезПоследних.Сотрудник
		                            |ГДЕ
		                            |	КадроваяИсторияСотрудниковСрезПоследних.ГоловнаяОрганизация = &ГоловнаяОрганизация
		                            |	И КадроваяИсторияСотрудниковСрезПоследних.Сотрудник = &Сотрудник
		                            |	И ПлановыеНачисленияСрезПоследних.Начисление = &Начисление"; 
		
		ЗапросНачисленийСКФ.УстановитьПараметр("Дата", КонецДня(Дата("20231231"))); 
		ЗапросНачисленийСКФ.УстановитьПараметр("ГоловнаяОрганизация", Объект.Организация); 
		ЗапросНачисленийСКФ.УстановитьПараметр("Начисление", ПланыВидовРасчета.Начисления.НайтиПоНаименованию("Северная надбавка"));
		ЗапросНачисленийСКФ.УстановитьПараметр("Сотрудник", Выборка.Сотрудник);
		РезультатНачисления = ЗапросНачисленийСКФ.Выполнить().Выбрать();
		Пока РезультатНачисления.Следующий() Цикл 
			///////////Добавляем в табличную часть документа Начисления	
			СтрокаТабличнойЧасти = НачальнаяШтатнаяРасстановка.Начисления.Добавить();
			СтрокаТабличнойЧасти.Сотрудник = РезультатНачисления.Сотрудник;
			СтрокаТабличнойЧасти.Начисление = РезультатНачисления.Начисление;
			СтрокаТабличнойЧасти.ИдентификаторСтрокиВидаРасчета = ИдентификаторСВНадбавка;
			СтрокаТабличнойЧасти.Размер = СтрокаТабличнойЧастиСотрудник.СовокупнаяТарифнаяСтавка *СеверныйКэф;
			//СтрокаТабличнойЧасти.ДатаНачала = РезультатНачисления.Начало;
			//СтрокаТабличнойЧасти.ДатаОкончания = РезультатНачисления.Окончание;  
			
			ИдентификаторСВНадбавка = ИдентификаторСВНадбавка +1;
		КонецЦикла;	

		
		//Выполняем запрос по таблице Показатели.
		ЗапросПоказатели = Новый Запрос;
		ЗапросПоказатели.Текст = "ВЫБРАТЬ
		|	ЗначенияПериодическихПоказателейРасчетаЗарплатыСотрудниковСрезПоследних.Значение КАК Значение,
		|	ЗначенияПериодическихПоказателейРасчетаЗарплатыСотрудниковСрезПоследних.Показатель КАК Показатель,
		|	КадроваяИсторияСотрудниковСрезПоследних.Сотрудник КАК Сотрудник
		|ИЗ
		|	РегистрСведений.КадроваяИсторияСотрудников.СрезПоследних(&Дата, ) КАК КадроваяИсторияСотрудниковСрезПоследних
		|		ЛЕВОЕ СОЕДИНЕНИЕ РегистрСведений.ЗначенияПериодическихПоказателейРасчетаЗарплатыСотрудников.СрезПоследних(&Дата, ) КАК ЗначенияПериодическихПоказателейРасчетаЗарплатыСотрудниковСрезПоследних
		|		ПО КадроваяИсторияСотрудниковСрезПоследних.Сотрудник = ЗначенияПериодическихПоказателейРасчетаЗарплатыСотрудниковСрезПоследних.Сотрудник
		|ГДЕ
		|	КадроваяИсторияСотрудниковСрезПоследних.ГоловнаяОрганизация = &ГоловнаяОрганизация
		|	И КадроваяИсторияСотрудниковСрезПоследних.Сотрудник = &Сотрудник"; 
		
		ЗапросПоказатели.УстановитьПараметр("Дата", КонецДня(Дата("20240102"))); 
		ЗапросПоказатели.УстановитьПараметр("ГоловнаяОрганизация", Объект.Организация);
		ЗапросПоказатели.УстановитьПараметр("Сотрудник", Выборка.Сотрудник);
		РезультатПоказатели = ЗапросПоказатели.Выполнить().Выбрать();
		Пока РезультатПоказатели.Следующий() Цикл
			///////////Показатели
			СтрокаТабличнойЧасти = НачальнаяШтатнаяРасстановка.Показатели.Добавить();
			
			//Если ЗапросНачислений.Начисление = ПланВидовРасчетовСсылка.Начисления И Запро 
				
				
			СтрокаТабличнойЧасти.Сотрудник = РезультатПоказатели.Сотрудник;
			СтруктураОтбора = Новый Структура;
			СтруктураОтбора.Вставить("Сотрудник",РезультатПоказатели.Сотрудник);
			Если РезультатПоказатели.Показатель = Справочники.ПоказателиРасчетаЗарплаты.РайонныйКоэффициент Тогда
				СтруктураОтбора.Вставить("Начисление",ПланыВидовРасчета.Начисления.НайтиПоНаименованию("Районный коэффициент"));
			ИначеЕсли РезультатПоказатели.Показатель = Справочники.ПоказателиРасчетаЗарплаты.Оклад Тогда  
				СтруктураОтбора.Вставить("Начисление",ПланыВидовРасчета.Начисления.НайтиПоНаименованию("Оплата по окладу"));
			КонецЕсли;
			
				
			СтрокиМассив = НачальнаяШтатнаяРасстановка.Начисления.НайтиСтроки(СтруктураОтбора);
			Если СтрокиМассив.Количество() >0 Тогда 
				СтрокаТабличнойЧасти.ИдентификаторСтрокиВидаРасчета = СтрокиМассив[0].ИдентификаторСтрокиВидаРасчета;
			КонецЕсли;
			//СтрокаТабличнойЧасти.ИдентификаторСтрокиВидаРасчета = ИдентификаторСВРП;
			СтрокаТабличнойЧасти.Показатель = РезультатПоказатели.Показатель;
			СтрокаТабличнойЧасти.Значение = РезультатПоказатели.Значение;
			
			//ИдентификаторСВРП = ИдентификаторСВРП +1;
		КонецЦикла;	
		
		
		
		
		
		
		//Выполняем запрос по таблицам Льготы.
		ЗапросЛьготы = Новый Запрос;
		ЗапросЛьготы.Текст = "ВЫБРАТЬ
		                     |	ПакетыЛьготСотрудникамПоШтатномуРасписанию.Льгота КАК Льгота,
		                     |	ПакетыЛьготСотрудникамПоШтатномуРасписанию.Размер КАК РазмерЛьготы,
		                     |	КадроваяИсторияСотрудниковСрезПоследних.Сотрудник КАК Сотрудник
		                     |ИЗ
		                     |	РегистрСведений.КадроваяИсторияСотрудников.СрезПоследних(&Дата, ) КАК КадроваяИсторияСотрудниковСрезПоследних
		                     |		ЛЕВОЕ СОЕДИНЕНИЕ РегистрСведений.ПакетыЛьготСотрудникамПоШтатномуРасписанию КАК ПакетыЛьготСотрудникамПоШтатномуРасписанию
		                     |		ПО КадроваяИсторияСотрудниковСрезПоследних.Должность = ПакетыЛьготСотрудникамПоШтатномуРасписанию.Должность
		                     |ГДЕ
		                     |	КадроваяИсторияСотрудниковСрезПоследних.ГоловнаяОрганизация = &ГоловнаяОрганизация
		                     |	И КадроваяИсторияСотрудниковСрезПоследних.Сотрудник = &Сотрудник
		                     |	И ПакетыЛьготСотрудникамПоШтатномуРасписанию.Льгота <> 0"; 
		
		ЗапросЛьготы.УстановитьПараметр("Дата", КонецДня(Дата("20231231"))); 
		ЗапросЛьготы.УстановитьПараметр("ГоловнаяОрганизация", Объект.Организация);
		ЗапросЛьготы.УстановитьПараметр("Сотрудник", Выборка.Сотрудник);
		РезультатЛьготы = ЗапросЛьготы.Выполнить().Выбрать();
		Пока РезультатЛьготы.Следующий() Цикл			
			//Таблица Льготы 
			//Если РезультатНачисления.Размер = РезультатНачисления.РазмерЛьготы Тогда
			СтрокаТабличнойЧасти = НачальнаяШтатнаяРасстановка.Льготы.Добавить();
			СтрокаТабличнойЧасти.Сотрудник = РезультатЛьготы.Сотрудник;
			СтрокаТабличнойЧасти.Льгота = РезультатЛьготы.РазмерЛьготы;
			СтрокаТабличнойЧасти.ИдентификаторСтрокиВидаРасчета = ИдентификаторСВРЛ+ 10000;
			СтрокаТабличнойЧасти.Размер = РезультатЛьготы.РазмерЛьготы;   
			//КонецЕсли;
			
			
			ИдентификаторСВРЛ = ИдентификаторСВРЛ + 1;
			
		КонецЦикла; 
		
		//Запросом получаем таблицу ЕжегодныеОтпуска	
		ЗапросВидЕжегодногоОтпуска = Новый Запрос;
		ЗапросВидЕжегодногоОтпуска.Текст = "ВЫБРАТЬ
		                                   |	ПоложенныеВидыЕжегодныхОтпусковСрезПоследних.ВидЕжегодногоОтпуска КАК ВидЕжегодногоОтпуска,
		                                   |	ПоложенныеВидыЕжегодныхОтпусковСрезПоследних.КоличествоДнейВГод КАК КоличествоДнейВГод,
		                                   |	ПоложенныеВидыЕжегодныхОтпусковСрезПоследних.Период КАК ДатаОстатка,
		                                   |	ПоложенныеВидыЕжегодныхОтпусковСрезПоследних.Сотрудник КАК Сотрудник,
		                                   |	ПоложенныеВидыЕжегодныхОтпусковСрезПоследних.КоличествоДнейВГодПоОкончании КАК КоличествоДней
		                                   |ИЗ
		                                   |	РегистрСведений.КадроваяИсторияСотрудников.СрезПоследних(&Дата, ) КАК КадроваяИсторияСотрудниковСрезПоследних
		                                   |		ЛЕВОЕ СОЕДИНЕНИЕ РегистрСведений.ПоложенныеВидыЕжегодныхОтпусков.СрезПоследних(&Дата, ) КАК ПоложенныеВидыЕжегодныхОтпусковСрезПоследних
		                                   |		ПО КадроваяИсторияСотрудниковСрезПоследних.Сотрудник = ПоложенныеВидыЕжегодныхОтпусковСрезПоследних.Сотрудник
		                                   |ГДЕ
		                                   |	КадроваяИсторияСотрудниковСрезПоследних.ГоловнаяОрганизация = &ГоловнаяОрганизация
		                                   |	И КадроваяИсторияСотрудниковСрезПоследних.Сотрудник = &Сотрудник
		                                   |	И ПоложенныеВидыЕжегодныхОтпусковСрезПоследних.Используется";
		ЗапросВидЕжегодногоОтпуска.УстановитьПараметр("Дата", КонецДня(Дата("20231231"))); 
		ЗапросВидЕжегодногоОтпуска.УстановитьПараметр("ГоловнаяОрганизация", Объект.Организация);
		ЗапросВидЕжегодногоОтпуска.УстановитьПараметр("Сотрудник", Выборка.Сотрудник);
		РезультатЕжегодныеОтпуска = ЗапросВидЕжегодногоОтпуска.Выполнить().Выбрать();
		Пока РезультатЕжегодныеОтпуска.Следующий() Цикл	
			/////////////ЕжегодныеОтпуска
			СтрокаТабличнойЧасти = НачальнаяШтатнаяРасстановка.ЕжегодныеОтпуска.Добавить();
			СтрокаТабличнойЧасти.Сотрудник = РезультатЕжегодныеОтпуска.Сотрудник;
			СтрокаТабличнойЧасти.ВидЕжегодногоОтпуска = РезультатЕжегодныеОтпуска.ВидЕжегодногоОтпуска;
			СтрокаТабличнойЧасти.КоличествоДнейВГод = РезультатЕжегодныеОтпуска.КоличествоДнейВГод;
			СтрокаТабличнойЧасти.ДатаОстатка = РезультатЕжегодныеОтпуска.ДатаОстатка;
			СтрокаТабличнойЧасти.КоличествоДней = РезультатЕжегодныеОтпуска.КоличествоДней;
			//СтрокаТабличнойЧасти.НеИспользовать = Выборка.НеИспользовать;
		КонецЦикла; 
		
				
		//ОстаткиОтпусковПоРабочимГодам запрос
		ЗапросОстаткиОтпусковПоРабочимГодам = Новый Запрос;
		ЗапросОстаткиОтпусковПоРабочимГодам.Текст = "ВЫБРАТЬ РАЗРЕШЕННЫЕ
		                                            |	ВидыОтпусков.Ссылка КАК ВидЕжегодногоОтпуска
		                                            |ПОМЕСТИТЬ ВТЕжегодныеОтпуска
		                                            |ИЗ
		                                            |	Справочник.ВидыОтпусков КАК ВидыОтпусков
		                                            |ГДЕ
		                                            |	ВидыОтпусков.ОтпускЯвляетсяЕжегодным = ИСТИНА
		                                            |;
		                                            |
		                                            |////////////////////////////////////////////////////////////////////////////////
		                                            |ВЫБРАТЬ РАЗРЕШЕННЫЕ
		                                            |	ЗаработанныеПраваНаОтпуска.Сотрудник КАК Сотрудник,
		                                            |	ЗаработанныеПраваНаОтпуска.ВидЕжегодногоОтпуска КАК ВидЕжегодногоОтпуска,
		                                            |	ЗаработанныеПраваНаОтпуска.ДатаНачала КАК ДатаНачала,
		                                            |	ЗаработанныеПраваНаОтпуска.ДатаОкончания КАК ДатаОкончания,
		                                            |	ЗаработанныеПраваНаОтпуска.Период КАК Период,
		                                            |	ЗаработанныеПраваНаОтпуска.КоличествоДней КАК КоличествоДней,
		                                            |	ЗаработанныеПраваНаОтпуска.КоличествоДнейЗаПериод КАК КоличествоДнейЗаПериод
		                                            |ПОМЕСТИТЬ ВТЗаработанныеПрава
		                                            |ИЗ
		                                            |	РегистрСведений.ЗаработанныеПраваНаОтпуска КАК ЗаработанныеПраваНаОтпуска
		                                            |		ВНУТРЕННЕЕ СОЕДИНЕНИЕ ВТЕжегодныеОтпуска КАК ЕжегодныеОтпуска
		                                            |		ПО ЗаработанныеПраваНаОтпуска.ВидЕжегодногоОтпуска = ЕжегодныеОтпуска.ВидЕжегодногоОтпуска
		                                            |		ВНУТРЕННЕЕ СОЕДИНЕНИЕ Справочник.Сотрудники КАК Сотрудники
		                                            |		ПО ЗаработанныеПраваНаОтпуска.Сотрудник = Сотрудники.Ссылка
		                                            |ГДЕ
		                                            |	ЗаработанныеПраваНаОтпуска.Период <= &ДатаОтчета
		                                            |;
		                                            |
		                                            |////////////////////////////////////////////////////////////////////////////////
		                                            |ВЫБРАТЬ
		                                            |	ВТЗаработанныеПрава.Сотрудник КАК Сотрудник,
		                                            |	ВТЗаработанныеПрава.ВидЕжегодногоОтпуска КАК ВидЕжегодногоОтпуска,
		                                            |	МАКСИМУМ(ВТЗаработанныеПрава.Период) КАК Период
		                                            |ПОМЕСТИТЬ ВТУказателиПоследних
		                                            |ИЗ
		                                            |	ВТЗаработанныеПрава КАК ВТЗаработанныеПрава
		                                            |
		                                            |СГРУППИРОВАТЬ ПО
		                                            |	ВТЗаработанныеПрава.Сотрудник,
		                                            |	ВТЗаработанныеПрава.ВидЕжегодногоОтпуска
		                                            |;
		                                            |
		                                            |////////////////////////////////////////////////////////////////////////////////
		                                            |ВЫБРАТЬ РАЗРЕШЕННЫЕ
		                                            |	ПоложенныеВидыЕжегодныхОтпусковСрезПоследних.Сотрудник КАК Сотрудник,
		                                            |	ПоложенныеВидыЕжегодныхОтпусковСрезПоследних.ВидЕжегодногоОтпуска КАК ВидЕжегодногоОтпуска,
		                                            |	ВЫБОР
		                                            |		КОГДА ПоложенныеВидыЕжегодныхОтпусковСрезПоследних.ДействуетДо <= &ДатаОтчета
		                                            |				И ПоложенныеВидыЕжегодныхОтпусковСрезПоследних.ДействуетДо <> ДАТАВРЕМЯ(1, 1, 1)
		                                            |			ТОГДА ПоложенныеВидыЕжегодныхОтпусковСрезПоследних.КоличествоДнейВГодПоОкончании
		                                            |		ИНАЧЕ ПоложенныеВидыЕжегодныхОтпусковСрезПоследних.КоличествоДнейВГод
		                                            |	КОНЕЦ КАК ДнейЕжегодно
		                                            |ПОМЕСТИТЬ ВТТекущиеПраваНаОтпуска
		                                            |ИЗ
		                                            |	РегистрСведений.ПоложенныеВидыЕжегодныхОтпусков.СрезПоследних(
		                                            |			&ДатаОтчета,
		                                            |			(Сотрудник, ВидЕжегодногоОтпуска) В
		                                            |				(ВЫБРАТЬ
		                                            |					ВТУказателиПоследних.Сотрудник,
		                                            |					ВТУказателиПоследних.ВидЕжегодногоОтпуска
		                                            |				ИЗ
		                                            |					ВТУказателиПоследних КАК ВТУказателиПоследних)) КАК ПоложенныеВидыЕжегодныхОтпусковСрезПоследних
		                                            |;
		                                            |
		                                            |////////////////////////////////////////////////////////////////////////////////
		                                            |ВЫБРАТЬ
		                                            |	ВТЗаработанныеПрава.Сотрудник КАК Сотрудник,
		                                            |	ВТЗаработанныеПрава.ВидЕжегодногоОтпуска КАК ВидЕжегодногоОтпуска,
		                                            |	ВТЗаработанныеПрава.Период КАК Период,
		                                            |	ЕСТЬNULL(ВТТекущиеПраваНаОтпуска.ДнейЕжегодно, 0) КАК ДнейЕжегодно
		                                            |ПОМЕСТИТЬ ВТЗаработанныеОтпускаПоследние
		                                            |ИЗ
		                                            |	ВТЗаработанныеПрава КАК ВТЗаработанныеПрава
		                                            |		ВНУТРЕННЕЕ СОЕДИНЕНИЕ ВТУказателиПоследних КАК ВТУказателиПоследних
		                                            |			ЛЕВОЕ СОЕДИНЕНИЕ ВТТекущиеПраваНаОтпуска КАК ВТТекущиеПраваНаОтпуска
		                                            |			ПО ВТУказателиПоследних.Сотрудник = ВТТекущиеПраваНаОтпуска.Сотрудник
		                                            |				И ВТУказателиПоследних.ВидЕжегодногоОтпуска = ВТТекущиеПраваНаОтпуска.ВидЕжегодногоОтпуска
		                                            |		ПО ВТЗаработанныеПрава.Сотрудник = ВТУказателиПоследних.Сотрудник
		                                            |			И ВТЗаработанныеПрава.ВидЕжегодногоОтпуска = ВТУказателиПоследних.ВидЕжегодногоОтпуска
		                                            |			И ВТЗаработанныеПрава.Период = ВТУказателиПоследних.Период
		                                            |;
		                                            |
		                                            |////////////////////////////////////////////////////////////////////////////////
		                                            |ВЫБРАТЬ
		                                            |	ЗаработанныеПрава.Сотрудник КАК Сотрудник,
		                                            |	ЗаработанныеПрава.ВидЕжегодногоОтпуска КАК ВидЕжегодногоОтпуска,
		                                            |	ЗаработанныеПрава.ДатаНачала КАК ДатаНачала,
		                                            |	ЗаработанныеПрава.ДатаОкончания КАК ДатаОкончания,
		                                            |	МАКСИМУМ(ЗаработанныеПрава.Период) КАК Период
		                                            |ПОМЕСТИТЬ ВТУказателиОкончанийРабочихЛетСотрудников
		                                            |ИЗ
		                                            |	ВТЗаработанныеПрава КАК ЗаработанныеПрава
		                                            |
		                                            |СГРУППИРОВАТЬ ПО
		                                            |	ЗаработанныеПрава.Сотрудник,
		                                            |	ЗаработанныеПрава.ВидЕжегодногоОтпуска,
		                                            |	ЗаработанныеПрава.ДатаНачала,
		                                            |	ЗаработанныеПрава.ДатаОкончания
		                                            |;
		                                            |
		                                            |////////////////////////////////////////////////////////////////////////////////
		                                            |ВЫБРАТЬ
		                                            |	ЗаработанныеПрава.Сотрудник КАК Сотрудник,
		                                            |	ЗаработанныеПрава.ВидЕжегодногоОтпуска КАК ВидЕжегодногоОтпуска,
		                                            |	ЗаработанныеПрава.ДатаНачала КАК ДатаНачала,
		                                            |	ЗаработанныеПрава.ДатаОкончания КАК ДатаОкончания,
		                                            |	ЗаработанныеПрава.КоличествоДней КАК Дней,
		                                            |	ЗаработанныеПрава.Период КАК Период
		                                            |ПОМЕСТИТЬ ВТЗаработанныеОтпускаПоГодам
		                                            |ИЗ
		                                            |	ВТЗаработанныеПрава КАК ЗаработанныеПрава
		                                            |		ВНУТРЕННЕЕ СОЕДИНЕНИЕ ВТУказателиОкончанийРабочихЛетСотрудников КАК ПериодыСотрудников
		                                            |		ПО ЗаработанныеПрава.Сотрудник = ПериодыСотрудников.Сотрудник
		                                            |			И ЗаработанныеПрава.ВидЕжегодногоОтпуска = ПериодыСотрудников.ВидЕжегодногоОтпуска
		                                            |			И ЗаработанныеПрава.ДатаНачала = ПериодыСотрудников.ДатаНачала
		                                            |			И ЗаработанныеПрава.ДатаОкончания = ПериодыСотрудников.ДатаОкончания
		                                            |			И ЗаработанныеПрава.Период = ПериодыСотрудников.Период
		                                            |;
		                                            |
		                                            |////////////////////////////////////////////////////////////////////////////////
		                                            |ВЫБРАТЬ РАЗРЕШЕННЫЕ
		                                            |	НачальныеОстаткиОтпусков.Сотрудник КАК Сотрудник,
		                                            |	МАКСИМУМ(НачальныеОстаткиОтпусков.ДатаОстатка) КАК ДатаОстатка
		                                            |ПОМЕСТИТЬ ВТНачальныеОстатки
		                                            |ИЗ
		                                            |	РегистрСведений.НачальныеОстаткиОтпусков КАК НачальныеОстаткиОтпусков
		                                            |
		                                            |СГРУППИРОВАТЬ ПО
		                                            |	НачальныеОстаткиОтпусков.Сотрудник
		                                            |;
		                                            |
		                                            |////////////////////////////////////////////////////////////////////////////////
		                                            |ВЫБРАТЬ РАЗРЕШЕННЫЕ
		                                            |	ФактическиеОтпуска.Сотрудник КАК Сотрудник,
		                                            |	ФактическиеОтпуска.ВидЕжегодногоОтпуска КАК ВидЕжегодногоОтпуска,
		                                            |	СУММА(ФактическиеОтпуска.Количество) КАК Отгуляно
		                                            |ПОМЕСТИТЬ ВТУчитываемыеОтпускаСотрудников
		                                            |ИЗ
		                                            |	РегистрНакопления.ФактическиеОтпуска КАК ФактическиеОтпуска
		                                            |		ЛЕВОЕ СОЕДИНЕНИЕ ВТНачальныеОстатки КАК ВТНачальныеОстатки
		                                            |		ПО ФактическиеОтпуска.Сотрудник = ВТНачальныеОстатки.Сотрудник
		                                            |		ВНУТРЕННЕЕ СОЕДИНЕНИЕ ВТЕжегодныеОтпуска КАК ВТЕжегодныеОтпуска
		                                            |		ПО ФактическиеОтпуска.ВидЕжегодногоОтпуска = ВТЕжегодныеОтпуска.ВидЕжегодногоОтпуска
		                                            |ГДЕ
		                                            |	ФактическиеОтпуска.Период >= ЕСТЬNULL(ВТНачальныеОстатки.ДатаОстатка, ДАТАВРЕМЯ(1, 1, 1))
		                                            |	И ФактическиеОтпуска.Период <= КОНЕЦПЕРИОДА(&ДатаОтчета, ДЕНЬ)
		                                            |	И НЕ ФактическиеОтпуска.Регистратор В (&НеучитываемыйРегистраторОтпусков)
		                                            |
		                                            |СГРУППИРОВАТЬ ПО
		                                            |	ФактическиеОтпуска.Сотрудник,
		                                            |	ФактическиеОтпуска.ВидЕжегодногоОтпуска
		                                            |;
		                                            |
		                                            |////////////////////////////////////////////////////////////////////////////////
		                                            |ВЫБРАТЬ
		                                            |	ЗаработанныеОтпускаПоГодам.Сотрудник КАК Сотрудник,
		                                            |	ЗаработанныеОтпускаПоГодам.ВидЕжегодногоОтпуска КАК ВидОтпуска,
		                                            |	ЗаработанныеОтпускаПоГодам.ДатаНачала КАК ДатаНачала,
		                                            |	ЗаработанныеОтпускаПоГодам.ДатаОкончания КАК ДатаОкончания,
		                                            |	ЗаработанныеОтпускаПоГодам.Дней КАК Дней,
		                                            |	ЗаработанныеОтпускаПоГодам.Период КАК Период,
		                                            |	ЕСТЬNULL(ВТУчитываемыеОтпускаСотрудников.Отгуляно, 0) КАК Отгуляно,
		                                            |	ЗаработанныеОтпускаПоГодам.Дней - ЕСТЬNULL(ВТУчитываемыеОтпускаСотрудников.Отгуляно, 0) КАК Остаток,
		                                            |	ВЫБОР
		                                            |		КОГДА ЗаработанныеОтпускаПоГодам.Дней - ЕСТЬNULL(ВТУчитываемыеОтпускаСотрудников.Отгуляно, 0) <= 0
		                                            |			ТОГДА ИСТИНА
		                                            |		ИНАЧЕ ЛОЖЬ
		                                            |	КОНЕЦ КАК РабочийГодЗакрыт
		                                            |ПОМЕСТИТЬ ВТРабочиеГодаСотрудников
		                                            |ИЗ
		                                            |	ВТЗаработанныеОтпускаПоГодам КАК ЗаработанныеОтпускаПоГодам
		                                            |		ЛЕВОЕ СОЕДИНЕНИЕ ВТУчитываемыеОтпускаСотрудников КАК ВТУчитываемыеОтпускаСотрудников
		                                            |		ПО ЗаработанныеОтпускаПоГодам.Сотрудник = ВТУчитываемыеОтпускаСотрудников.Сотрудник
		                                            |			И ЗаработанныеОтпускаПоГодам.ВидЕжегодногоОтпуска = ВТУчитываемыеОтпускаСотрудников.ВидЕжегодногоОтпуска
		                                            |;
		                                            |
		                                            |////////////////////////////////////////////////////////////////////////////////
		                                            |ВЫБРАТЬ
		                                            |	РабочиеГодаСотрудников.Сотрудник КАК Сотрудник,
		                                            |	РабочиеГодаСотрудников.ВидОтпуска КАК ВидОтпуска,
		                                            |	РабочиеГодаСотрудников.ДатаНачала КАК РабочийГодДатаНачала,
		                                            |	МАКСИМУМ(ЕСТЬNULL(РабочиеГодаСотрудниковПредыдущие.ДатаНачала, РабочиеГодаСотрудников.ДатаНачала)) КАК ПредыдущийРабочийГодДатаНачала
		                                            |ПОМЕСТИТЬ ВТУказателиРабочихЛет
		                                            |ИЗ
		                                            |	ВТРабочиеГодаСотрудников КАК РабочиеГодаСотрудников
		                                            |		ЛЕВОЕ СОЕДИНЕНИЕ ВТРабочиеГодаСотрудников КАК РабочиеГодаСотрудниковПредыдущие
		                                            |		ПО РабочиеГодаСотрудников.Сотрудник = РабочиеГодаСотрудниковПредыдущие.Сотрудник
		                                            |			И РабочиеГодаСотрудников.ВидОтпуска = РабочиеГодаСотрудниковПредыдущие.ВидОтпуска
		                                            |			И РабочиеГодаСотрудников.ДатаНачала > РабочиеГодаСотрудниковПредыдущие.ДатаНачала
		                                            |
		                                            |СГРУППИРОВАТЬ ПО
		                                            |	РабочиеГодаСотрудников.Сотрудник,
		                                            |	РабочиеГодаСотрудников.ВидОтпуска,
		                                            |	РабочиеГодаСотрудников.ДатаНачала
		                                            |;
		                                            |
		                                            |////////////////////////////////////////////////////////////////////////////////
		                                            |ВЫБРАТЬ
		                                            |	УказателиРабочихЛет.Сотрудник КАК Сотрудник,
		                                            |	УказателиРабочихЛет.ВидОтпуска КАК ВидОтпуска,
		                                            |	УказателиРабочихЛет.РабочийГодДатаНачала КАК РабочийГодДатаНачала,
		                                            |	РабочиеГодаСотрудников.ДатаОкончания КАК РабочийГодДатаОкончания,
		                                            |	РабочиеГодаСотрудников.Период КАК Период,
		                                            |	РабочиеГодаСотрудников.Остаток КАК НарастающийОстаток,
		                                            |	РабочиеГодаСотрудниковПредыдущие.Остаток КАК ПредыдущийНарастающийОстаток,
		                                            |	ВЫБОР
		                                            |		КОГДА РабочиеГодаСотрудников.Остаток < 0
		                                            |			ТОГДА ВЫБОР
		                                            |					КОГДА НЕ ВТЗаработанныеОтпускаПоследние.Сотрудник ЕСТЬ NULL
		                                            |						ТОГДА РабочиеГодаСотрудников.Остаток
		                                            |					ИНАЧЕ 0
		                                            |				КОНЕЦ
		                                            |		КОГДА УказателиРабочихЛет.РабочийГодДатаНачала = УказателиРабочихЛет.ПредыдущийРабочийГодДатаНачала
		                                            |			ТОГДА РабочиеГодаСотрудников.Остаток
		                                            |		КОГДА РабочиеГодаСотрудниковПредыдущие.Остаток < 0
		                                            |			ТОГДА РабочиеГодаСотрудников.Остаток
		                                            |		ИНАЧЕ РабочиеГодаСотрудников.Остаток - РабочиеГодаСотрудниковПредыдущие.Остаток
		                                            |	КОНЕЦ КАК ОстатокГода,
		                                            |	NULL КАК ЧасыОстаток,
		                                            |	ЕСТЬNULL(ТекущееДнейЕжегодно.ДнейЕжегодно, 0) КАК ДнейЕжегодно,
		                                            |	ВЫБОР
		                                            |		КОГДА НЕ ВТЗаработанныеОтпускаПоследние.Сотрудник ЕСТЬ NULL
		                                            |			ТОГДА ИСТИНА
		                                            |		ИНАЧЕ ЛОЖЬ
		                                            |	КОНЕЦ КАК ПоследнийГод
		                                            |ПОМЕСТИТЬ ВТИтоговыеРабочиеГодаОтпусков
		                                            |ИЗ
		                                            |	ВТУказателиРабочихЛет КАК УказателиРабочихЛет
		                                            |		ЛЕВОЕ СОЕДИНЕНИЕ ВТРабочиеГодаСотрудников КАК РабочиеГодаСотрудников
		                                            |			ЛЕВОЕ СОЕДИНЕНИЕ ВТЗаработанныеОтпускаПоследние КАК ВТЗаработанныеОтпускаПоследние
		                                            |			ПО РабочиеГодаСотрудников.Сотрудник = ВТЗаработанныеОтпускаПоследние.Сотрудник
		                                            |				И РабочиеГодаСотрудников.ВидОтпуска = ВТЗаработанныеОтпускаПоследние.ВидЕжегодногоОтпуска
		                                            |				И РабочиеГодаСотрудников.Период = ВТЗаработанныеОтпускаПоследние.Период
		                                            |		ПО УказателиРабочихЛет.Сотрудник = РабочиеГодаСотрудников.Сотрудник
		                                            |			И УказателиРабочихЛет.ВидОтпуска = РабочиеГодаСотрудников.ВидОтпуска
		                                            |			И УказателиРабочихЛет.РабочийГодДатаНачала = РабочиеГодаСотрудников.ДатаНачала
		                                            |		ЛЕВОЕ СОЕДИНЕНИЕ ВТРабочиеГодаСотрудников КАК РабочиеГодаСотрудниковПредыдущие
		                                            |		ПО УказателиРабочихЛет.Сотрудник = РабочиеГодаСотрудниковПредыдущие.Сотрудник
		                                            |			И УказателиРабочихЛет.ВидОтпуска = РабочиеГодаСотрудниковПредыдущие.ВидОтпуска
		                                            |			И УказателиРабочихЛет.ПредыдущийРабочийГодДатаНачала = РабочиеГодаСотрудниковПредыдущие.ДатаНачала
		                                            |		ЛЕВОЕ СОЕДИНЕНИЕ ВТЗаработанныеОтпускаПоследние КАК ТекущееДнейЕжегодно
		                                            |		ПО УказателиРабочихЛет.Сотрудник = ТекущееДнейЕжегодно.Сотрудник
		                                            |			И УказателиРабочихЛет.ВидОтпуска = ТекущееДнейЕжегодно.ВидЕжегодногоОтпуска
		                                            |;
		                                            |
		                                            |////////////////////////////////////////////////////////////////////////////////
		                                            |ВЫБРАТЬ РАЗРЕШЕННЫЕ
		                                            |	РабочиеГодаСотрудников.Сотрудник КАК Сотрудник,
		                                            |	РабочиеГодаСотрудников.ОстатокГода КАК ДниОстаток,
		                                            |	NULL КАК ЧасыОстаток,
		                                            |	РабочиеГодаСотрудников.ВидОтпуска КАК ВидОтпуска,
		                                            |	РабочиеГодаСотрудников.РабочийГодДатаНачала КАК РабочийГодДатаНачала,
		                                            |	РабочиеГодаСотрудников.РабочийГодДатаОкончания КАК РабочийГодДатаОкончания,
		                                            |	РабочиеГодаСотрудников.Период КАК Период,
		                                            |	РабочиеГодаСотрудников.ДнейЕжегодно КАК ДнейЕжегодно,
		                                            |	РабочиеГодаСотрудников.ПоследнийГод КАК ПоследнийГод
		                                            |ПОМЕСТИТЬ ВТИтоговыеСотрудники
		                                            |ИЗ
		                                            |	ВТИтоговыеРабочиеГодаОтпусков КАК РабочиеГодаСотрудников
		                                            |
		                                            |ОБЪЕДИНИТЬ ВСЕ
		                                            |
		                                            |ВЫБРАТЬ
		                                            |	ДниЧасыОтгуловОстатки.Сотрудник,
		                                            |	ДниЧасыОтгуловОстатки.ДниОстаток,
		                                            |	ДниЧасыОтгуловОстатки.ЧасыОстаток,
		                                            |	NULL,
		                                            |	NULL,
		                                            |	NULL,
		                                            |	NULL,
		                                            |	NULL,
		                                            |	NULL
		                                            |ИЗ
		                                            |	РегистрНакопления.ДниЧасыОтгулов.Остатки(&ДатаОтчета, ) КАК ДниЧасыОтгуловОстатки
		                                            |;
		                                            |
		                                            |////////////////////////////////////////////////////////////////////////////////
		                                            |ВЫБРАТЬ РАЗРЕШЕННЫЕ
		                                            |	Сотрудники.Ссылка КАК Сотрудник,
		                                            |	&ДатаОтчета КАК Период
		                                            |ПОМЕСТИТЬ ВТСотрудники
		                                            |{ВЫБРАТЬ
		                                            |	Сотрудник.*}
		                                            |ИЗ
		                                            |	Справочник.Сотрудники КАК Сотрудники
		                                            |{ГДЕ
		                                            |	Сотрудники.Ссылка.* КАК Сотрудник,
		                                            |	Сотрудники.ФизическоеЛицо.*,
		                                            |	Сотрудники.ГоловнаяОрганизация.*}
		                                            |;
		                                            |
		                                            |////////////////////////////////////////////////////////////////////////////////
		                                            |ВЫБРАТЬ РАЗРЕШЕННЫЕ
		                                            |	ЗНАЧЕНИЕ(Справочник.Сотрудники.ПустаяСсылка) КАК Сотрудник,
		                                            |	"""" КАК ТабельныйНомер,
		                                            |	ЗНАЧЕНИЕ(Справочник.ФизическиеЛица.ПустаяСсылка) КАК ФизическоеЛицо,
		                                            |	ЗНАЧЕНИЕ(Справочник.Организации.ПустаяСсылка) КАК ГоловнаяОрганизация,
		                                            |	ЗНАЧЕНИЕ(Справочник.Организации.ПустаяСсылка) КАК Организация,
		                                            |	ЗНАЧЕНИЕ(Справочник.ПодразделенияОрганизаций.ПустаяСсылка) КАК Подразделение,
		                                            |	ЗНАЧЕНИЕ(Справочник.Должности.ПустаяСсылка) КАК Должность,
		                                            |	ЗНАЧЕНИЕ(Перечисление.ВидыЗанятости.ПустаяСсылка) КАК ВидЗанятости,
		                                            |	ДАТАВРЕМЯ(1, 1, 1) КАК ДатаПриема,
		                                            |	ДАТАВРЕМЯ(1, 1, 1) КАК ДатаУвольнения,
		                                            |	ЗНАЧЕНИЕ(Перечисление.СостоянияСотрудника.ПустаяСсылка) КАК Состояние
		                                            |ПОМЕСТИТЬ Представления_КадровыеДанныеСотрудников
		                                            |ИЗ
		                                            |	ВТСотрудники КАК ВТСотрудники
		                                            |ГДЕ
		                                            |	""ТолькоРазрешенные"" = ИСТИНА
		                                            |;
		                                            |
		                                            |////////////////////////////////////////////////////////////////////////////////
		                                            |ВЫБРАТЬ
		                                            |	Сотрудники.Сотрудник КАК Сотрудник
		                                            |ПОМЕСТИТЬ ВТНеучтенныеСотрудники
		                                            |ИЗ
		                                            |	ВТСотрудники КАК Сотрудники
		                                            |		ЛЕВОЕ СОЕДИНЕНИЕ ВТИтоговыеСотрудники КАК ИтоговыеСотрудники
		                                            |		ПО Сотрудники.Сотрудник = ИтоговыеСотрудники.Сотрудник
		                                            |ГДЕ
		                                            |	ИтоговыеСотрудники.Сотрудник ЕСТЬ NULL
		                                            |;
		                                            |
		                                            |////////////////////////////////////////////////////////////////////////////////
		                                            |ВЫБРАТЬ РАЗРЕШЕННЫЕ
		                                            |	ПоложенныеВидыЕжегодныхОтпусковСрезПоследних.Сотрудник КАК Сотрудник,
		                                            |	ПоложенныеВидыЕжегодныхОтпусковСрезПоследних.ВидЕжегодногоОтпуска КАК ВидОтпуска,
		                                            |	ПоложенныеВидыЕжегодныхОтпусковСрезПоследних.КоличествоДнейВГод КАК ДнейЕжегодно
		                                            |ПОМЕСТИТЬ ВТПраваНаОтпускаНеучтенныхСотрудников
		                                            |ИЗ
		                                            |	РегистрСведений.ПоложенныеВидыЕжегодныхОтпусков.СрезПоследних(
		                                            |			&ДатаОтчета,
		                                            |			Сотрудник В
		                                            |				(ВЫБРАТЬ
		                                            |					НеучтенныеСотрудники.Сотрудник
		                                            |				ИЗ
		                                            |					ВТНеучтенныеСотрудники КАК НеучтенныеСотрудники)) КАК ПоложенныеВидыЕжегодныхОтпусковСрезПоследних
		                                            |;
		                                            |
		                                            |////////////////////////////////////////////////////////////////////////////////
		                                            |ВЫБРАТЬ
		                                            |	ИтоговыеСотрудники.Сотрудник КАК Сотрудник,
		                                            |	ИтоговыеСотрудники.ВидОтпуска КАК ВидОтпуска,
		                                            |	ИтоговыеСотрудники.ДнейЕжегодно КАК ДнейЕжегодно,
		                                            |	ВЫБОР
		                                            |		КОГДА ИтоговыеСотрудники.ВидОтпуска ЕСТЬ NULL
		                                            |			ТОГДА 3
		                                            |		КОГДА ИтоговыеСотрудники.ВидОтпуска = &ОсновнойОтпуск
		                                            |			ТОГДА 1
		                                            |		ИНАЧЕ 2
		                                            |	КОНЕЦ КАК ПриоритетВидаОтпуска,
		                                            |	ИтоговыеСотрудники.РабочийГодДатаНачала КАК РабочийГодДатаНачала,
		                                            |	ИтоговыеСотрудники.РабочийГодДатаОкончания КАК РабочийГодДатаОкончания,
		                                            |	ИтоговыеСотрудники.ДниОстаток КАК Дни,
		                                            |	ИтоговыеСотрудники.ЧасыОстаток КАК Часы,
		                                            |	ВЫБОР
		                                            |		КОГДА ИтоговыеСотрудники.ВидОтпуска ЕСТЬ NULL
		                                            |			ТОГДА ЛОЖЬ
		                                            |		ИНАЧЕ ИСТИНА
		                                            |	КОНЕЦ КАК ЭтоОтпуск,
		                                            |	ВЫБОР
		                                            |		КОГДА ИтоговыеСотрудники.ВидОтпуска ЕСТЬ NULL
		                                            |			ТОГДА ИСТИНА
		                                            |		ИНАЧЕ ЛОЖЬ
		                                            |	КОНЕЦ КАК ЭтоОтгул,
		                                            |	КадровыеДанныеСотрудников.ТабельныйНомер КАК ТабельныйНомер,
		                                            |	КадровыеДанныеСотрудников.ФизическоеЛицо КАК ФизическоеЛицо,
		                                            |	КадровыеДанныеСотрудников.ГоловнаяОрганизация КАК ГоловнаяОрганизация,
		                                            |	КадровыеДанныеСотрудников.Организация КАК ТекущаяОрганизация,
		                                            |	КадровыеДанныеСотрудников.Подразделение КАК Подразделение,
		                                            |	КадровыеДанныеСотрудников.Должность КАК Должность,
		                                            |	КадровыеДанныеСотрудников.ВидЗанятости КАК ВидЗанятости,
		                                            |	КадровыеДанныеСотрудников.ДатаПриема КАК ДатаПриема,
		                                            |	КадровыеДанныеСотрудников.ДатаУвольнения КАК ДатаУвольнения,
		                                            |	КадровыеДанныеСотрудников.Состояние КАК Состояние
		                                            |ИЗ
		                                            |	ВТИтоговыеСотрудники КАК ИтоговыеСотрудники
		                                            |		ЛЕВОЕ СОЕДИНЕНИЕ Представления_КадровыеДанныеСотрудников КАК КадровыеДанныеСотрудников
		                                            |		ПО ИтоговыеСотрудники.Сотрудник = КадровыеДанныеСотрудников.Сотрудник
		                                            |ГДЕ
		                                            |	ИтоговыеСотрудники.Сотрудник = &Сотрудник
		                                            |
		                                            |ОБЪЕДИНИТЬ ВСЕ
		                                            |
		                                            |ВЫБРАТЬ
		                                            |	ПраваНаОтпускаНеучтенныхСотрудников.Сотрудник,
		                                            |	ПраваНаОтпускаНеучтенныхСотрудников.ВидОтпуска,
		                                            |	ПраваНаОтпускаНеучтенныхСотрудников.ДнейЕжегодно,
		                                            |	ВЫБОР
		                                            |		КОГДА ПраваНаОтпускаНеучтенныхСотрудников.ВидОтпуска ЕСТЬ NULL
		                                            |			ТОГДА 3
		                                            |		КОГДА ПраваНаОтпускаНеучтенныхСотрудников.ВидОтпуска = &ОсновнойОтпуск
		                                            |			ТОГДА 1
		                                            |		ИНАЧЕ 2
		                                            |	КОНЕЦ,
		                                            |	ДАТАВРЕМЯ(1, 1, 1),
		                                            |	ДАТАВРЕМЯ(1, 1, 1),
		                                            |	0,
		                                            |	0,
		                                            |	ВЫБОР
		                                            |		КОГДА ПраваНаОтпускаНеучтенныхСотрудников.ВидОтпуска ЕСТЬ NULL
		                                            |			ТОГДА ЛОЖЬ
		                                            |		ИНАЧЕ ИСТИНА
		                                            |	КОНЕЦ,
		                                            |	ВЫБОР
		                                            |		КОГДА ПраваНаОтпускаНеучтенныхСотрудников.ВидОтпуска ЕСТЬ NULL
		                                            |			ТОГДА ИСТИНА
		                                            |		ИНАЧЕ ЛОЖЬ
		                                            |	КОНЕЦ,
		                                            |	КадровыеДанныеСотрудников.ТабельныйНомер,
		                                            |	КадровыеДанныеСотрудников.ФизическоеЛицо,
		                                            |	КадровыеДанныеСотрудников.ГоловнаяОрганизация,
		                                            |	КадровыеДанныеСотрудников.Организация,
		                                            |	КадровыеДанныеСотрудников.Подразделение,
		                                            |	КадровыеДанныеСотрудников.Должность,
		                                            |	КадровыеДанныеСотрудников.ВидЗанятости,
		                                            |	КадровыеДанныеСотрудников.ДатаПриема,
		                                            |	КадровыеДанныеСотрудников.ДатаУвольнения,
		                                            |	КадровыеДанныеСотрудников.Состояние
		                                            |ИЗ
		                                            |	ВТПраваНаОтпускаНеучтенныхСотрудников КАК ПраваНаОтпускаНеучтенныхСотрудников
		                                            |		ВНУТРЕННЕЕ СОЕДИНЕНИЕ Представления_КадровыеДанныеСотрудников КАК КадровыеДанныеСотрудников
		                                            |		ПО ПраваНаОтпускаНеучтенныхСотрудников.Сотрудник = КадровыеДанныеСотрудников.Сотрудник
		                                            |		ЛЕВОЕ СОЕДИНЕНИЕ ВТИтоговыеСотрудники КАК ИтоговыеСотрудники
		                                            |		ПО ПраваНаОтпускаНеучтенныхСотрудников.Сотрудник = ИтоговыеСотрудники.Сотрудник
		                                            |			И ПраваНаОтпускаНеучтенныхСотрудников.ВидОтпуска = ИтоговыеСотрудники.ВидОтпуска
		                                            |ГДЕ
		                                            |	ИтоговыеСотрудники.ВидОтпуска ЕСТЬ NULL";
		ЗапросОстаткиОтпусковПоРабочимГодам.УстановитьПараметр("ДатаОтчета", КонецДня(Дата("20231231"))); 
		//ЗапросОстаткиОтпусковПоРабочимГодам.УстановитьПараметр("ГоловнаяОрганизация", Объект.Организация);
		ЗапросОстаткиОтпусковПоРабочимГодам.УстановитьПараметр("Сотрудник", Выборка.Сотрудник);
		ЗапросОстаткиОтпусковПоРабочимГодам.УстановитьПараметр("НеучитываемыйРегистраторОтпусков", "");
		ЗапросОстаткиОтпусковПоРабочимГодам.УстановитьПараметр("ОсновнойОтпуск", "");
		РезультатОтпусковПоРабочимГодам = ЗапросОстаткиОтпусковПоРабочимГодам.Выполнить().Выбрать();
		Пока РезультатОтпусковПоРабочимГодам.Следующий() Цикл
			
			//
			/////////////ОстаткиОтпусковПоРабочимГодам
			СтрокаТабличнойЧасти = НачальнаяШтатнаяРасстановка.ОстаткиОтпусковПоРабочимГодам.Добавить();
			СтрокаТабличнойЧасти.Сотрудник = РезультатОтпусковПоРабочимГодам.Сотрудник;
			СтрокаТабличнойЧасти.ВидЕжегодногоОтпуска = РезультатОтпусковПоРабочимГодам.ВидОтпуска;
			СтрокаТабличнойЧасти.ДатаОстатка = КонецДня(Дата("20231231"));
			СтрокаТабличнойЧасти.РабочийГодНачало = РезультатОтпусковПоРабочимГодам.РабочийГодДатаНачала;
			СтрокаТабличнойЧасти.РабочийГодОкончание = РезультатОтпусковПоРабочимГодам.РабочийГодДатаОкончания;
			СтрокаТабличнойЧасти.Остаток = РезультатОтпусковПоРабочимГодам.Дни; 
			
			СтруктураОтбора = Новый Структура;
			СтруктураОтбора.Вставить("Сотрудник",РезультатОтпусковПоРабочимГодам.Сотрудник);
			СтруктураОтбора.Вставить("ВидЕжегодногоОтпуска", РезультатОтпусковПоРабочимГодам.ВидОтпуска);
				
				
			СтрокиМассив = НачальнаяШтатнаяРасстановка.ЕжегодныеОтпуска.НайтиСтроки(СтруктураОтбора);
			Если СтрокиМассив.Количество() >0 Тогда 
				СтрокиМассив[0].КоличествоДней = СтрокиМассив[0].КоличествоДней + РезультатОтпусковПоРабочимГодам.Дни;	
			КонецЕсли;

			
			
		КонецЦикла;
		
		// Запрос ОтсутствияСдвигающиеРабочийГод
		ЗапросОтсутствияСдвигающиеРабочийГод = Новый Запрос;
		ЗапросОтсутствияСдвигающиеРабочийГод.Текст = "ВЫБРАТЬ
		                                             |	ОтсутствияСдвигающиеРабочийГод.Сотрудник КАК Сотрудник,
		                                             |	ОтсутствияСдвигающиеРабочийГод.ВидЕжегодногоОтпуска КАК ВидЕжегодногоОтпуска,
		                                             |	ОтсутствияСдвигающиеРабочийГод.ДатаОстатка КАК ДатаОстатка,
		                                             |	ОтсутствияСдвигающиеРабочийГод.Состояние КАК Состояние,
		                                             |	ОтсутствияСдвигающиеРабочийГод.КоличествоДней КАК КоличествоДней
		                                             |ИЗ
		                                             |	РегистрСведений.ОтсутствияСдвигающиеРабочийГод КАК ОтсутствияСдвигающиеРабочийГод
		                                             |		ЛЕВОЕ СОЕДИНЕНИЕ РегистрСведений.КадроваяИсторияСотрудников.СрезПоследних(&Дата, ) КАК КадроваяИсторияСотрудниковСрезПоследних
		                                             |		ПО ОтсутствияСдвигающиеРабочийГод.Сотрудник = КадроваяИсторияСотрудниковСрезПоследних.Сотрудник
		                                             |ГДЕ
		                                             |	КадроваяИсторияСотрудниковСрезПоследних.Сотрудник = &Сотрудник
		                                             |	И КадроваяИсторияСотрудниковСрезПоследних.ГоловнаяОрганизация = &ГоловнаяОрганизация";
		
		ЗапросОтсутствияСдвигающиеРабочийГод.УстановитьПараметр("Дата", КонецДня(Дата("20231231"))); 
		ЗапросОтсутствияСдвигающиеРабочийГод.УстановитьПараметр("ГоловнаяОрганизация", Объект.Организация);
		ЗапросОтсутствияСдвигающиеРабочийГод.УстановитьПараметр("Сотрудник", Выборка.Сотрудник);
		РезультатаОтсутствияСдвигающиеРабочийГод = ЗапросОтсутствияСдвигающиеРабочийГод.Выполнить().Выбрать();
		Пока РезультатаОтсутствияСдвигающиеРабочийГод.Следующий() Цикл
			/////////////ОтсутствияСдвигающиеРабочийГод
			//
			СтрокаТабличнойЧасти = НачальнаяШтатнаяРасстановка.ОтсутствияСдвигающиеРабочийГод.Добавить();
			СтрокаТабличнойЧасти.Сотрудник = РезультатаОтсутствияСдвигающиеРабочийГод.Сотрудник;
			СтрокаТабличнойЧасти.ВидЕжегодногоОтпуска = РезультатаОтсутствияСдвигающиеРабочийГод.ВидЕжегодногоОтпуска;
			СтрокаТабличнойЧасти.ДатаОстатка = РезультатаОтсутствияСдвигающиеРабочийГод.ДатаОстатка;
			СтрокаТабличнойЧасти.Состояние = РезультатаОтсутствияСдвигающиеРабочийГод.Состояние;
			СтрокаТабличнойЧасти.КоличествоДней = РезультатаОтсутствияСдвигающиеРабочийГод.КоличествоДней; 
			
			
		КонецЦикла;
	КонецЦикла;
	
	
	
	//Записываем документ
	//НачальнаяШтатнаяРасстановка.Записать(РежимЗаписиДокумента.Проведение);
	
	НачальнаяШтатнаяРасстановка.Записать();
КонецПроцедуры

&НаКлиенте
Процедура Создать(Команда)
	СоздатьНаСервере();
	Сообщить("Выполнено");
КонецПроцедуры

/////



